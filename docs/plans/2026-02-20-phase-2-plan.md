# 鄭南榕事件互動體驗網站 — Phase 2 Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Build the three remaining narrative chapters (Ch.03 調查歷程, Ch.04 監控真相, Ch.05 未解之謎) with their supporting components and CRT mini-interactions, then integrate them into the existing app shell.

**Architecture:** Each chapter follows the established pattern: named export function, `Section` wrapper with `id` matching nav, `ScrollReveal`-wrapped content blocks inside `max-w-[640px] space-y-16` container. New CRT interactions reuse `CRTOverlay` as parent modal. New shared components (StatuteComparison, BurntEdgeCard, PageCounter) are pure presentational. The `Redacted` component gains a `permanent` prop for the 解密互動.

**Tech Stack:** React 19, TypeScript 5.9, Tailwind CSS 4, Vite. No new dependencies.

**Reference files:**
- Chapter pattern: `src/chapters/HistoricalContext.tsx` (most complex existing chapter)
- CRT interaction pattern: `src/components/crt/StatuteJudgment.tsx`
- Data consumed: `src/data/legal.ts`, `src/data/surveillance.ts`, `src/data/selfImprisonment.ts`

---

## Batch 1: Foundation Components (Tasks 1–5)

### Task 1: Add `permanent` prop to Redacted component

The existing `Redacted` component is toggle-based (click re-hides). The 解密互動 in Ch.03 and Ch.04 needs a one-shot reveal that stays permanently visible after clicking.

**Files:**
- Modify: `src/components/narrative/Redacted.tsx`

**Step 1: Add permanent prop**

```tsx
import { useState } from 'react'

interface RedactedProps {
  children: React.ReactNode
  /** When true, text stays revealed permanently after first click (no toggle back) */
  permanent?: boolean
  /** Callback fired when text is revealed (useful for counting reveals) */
  onReveal?: () => void
}

export function Redacted({ children, permanent = false, onReveal }: RedactedProps) {
  const [revealed, setRevealed] = useState(false)

  const handleReveal = () => {
    if (permanent && revealed) return
    const next = permanent ? true : !revealed
    setRevealed(next)
    if (next && onReveal) onReveal()
  }

  return (
    <span
      role="button"
      tabIndex={0}
      aria-label={revealed ? undefined : '點擊揭示隱藏文字'}
      className={`inline cursor-pointer select-none rounded-sm px-[0.3em] py-[0.15em] transition-all duration-700 ${
        revealed
          ? 'bg-blood/15 text-blood underline decoration-wavy underline-offset-4'
          : 'redacted-bar border border-smoke/50 bg-ash text-transparent hover:border-blood-dark/60 hover:bg-smoke/80'
      }`}
      style={{ minHeight: '44px', minWidth: '44px', touchAction: 'manipulation' }}
      onClick={handleReveal}
      onKeyDown={(e) => {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault()
          handleReveal()
        }
      }}
    >
      {children}
    </span>
  )
}
```

**Step 2: Verify build**

```bash
npm run build
```

Expected: Build succeeds with no errors.

**Step 3: Commit**

```bash
git add src/components/narrative/Redacted.tsx
git commit -m "feat: add permanent and onReveal props to Redacted component"
```

---

### Task 2: Create StatuteComparison component

Side-by-side display of 刑法第100條 before/after the 1992 amendment, with highlighted segments showing what changed. Used in Ch.03.

**Files:**
- Create: `src/components/legal/StatuteComparison.tsx`

**Step 1: Create the component**

```tsx
import { ScrollReveal } from '../narrative/ScrollReveal'
import { statuteComparisonData } from '../../data/legal'

export function StatuteComparison() {
  const { before, after, keyChange, source } = statuteComparisonData

  return (
    <div className="space-y-8">
      <h3 className="font-heading text-[clamp(1.1rem,3vw,1.4rem)] font-bold text-paper-aged">
        {statuteComparisonData.title}
      </h3>

      {/* Side-by-side on desktop, stacked on mobile */}
      <div className="grid gap-6 md:grid-cols-2">
        {/* Before */}
        <ScrollReveal>
          <div className="border border-seal-red/30 bg-void/50 p-5">
            <div className="mb-3 font-document text-[0.7rem] tracking-[0.15em] text-seal-red/70">
              {before.label}
            </div>
            <p className="mb-4 font-narrative text-[0.9rem] leading-[2] text-dust">
              {before.segments.map((seg, i) => (
                <span
                  key={i}
                  className={seg.isHighlighted ? 'bg-seal-red/20 text-paper-aged' : ''}
                >
                  {seg.text}
                </span>
              ))}
            </p>
            <div className="border-t border-smoke/30 pt-3 font-document text-[0.75rem] leading-[1.8] text-seal-red/80">
              {before.effectWithArticle21}
            </div>
            <p className="mt-2 font-narrative text-[0.8rem] italic text-stone">
              {before.note}
            </p>
          </div>
        </ScrollReveal>

        {/* After */}
        <ScrollReveal delay={100}>
          <div className="border border-surveillance-green/30 bg-void/50 p-5">
            <div className="mb-3 font-document text-[0.7rem] tracking-[0.15em] text-surveillance-green/70">
              {after.label}
            </div>
            <p className="mb-4 font-narrative text-[0.9rem] leading-[2] text-dust">
              {after.segments.map((seg, i) => (
                <span
                  key={i}
                  className={seg.isHighlighted ? 'bg-surveillance-green/20 text-paper-aged' : ''}
                >
                  {seg.text}
                </span>
              ))}
            </p>
            <p className="mt-2 font-narrative text-[0.8rem] italic text-stone">
              {after.note}
            </p>
          </div>
        </ScrollReveal>
      </div>

      {/* Key change callout */}
      <ScrollReveal>
        <div className="border-l-2 border-surveillance-green/50 pl-4">
          <p className="font-narrative text-[0.9rem] leading-[2] text-paper-aged">
            {keyChange}
          </p>
        </div>
      </ScrollReveal>

      <div className="font-document text-[0.65rem] tracking-wider text-stone/50">
        {source}
      </div>
    </div>
  )
}
```

**Step 2: Verify build**

```bash
npm run build
```

Expected: Build succeeds.

**Step 3: Commit**

```bash
git add src/components/legal/StatuteComparison.tsx
git commit -m "feat: create StatuteComparison component for old/new article 100 display"
```

---

### Task 3: Create BurntEdgeCard component

Expandable card with a charred paper edge visual effect using the `--char-*` and `--scorch` colors. Used in Ch.05 for the four mystery panels.

**Files:**
- Create: `src/components/interactive/BurntEdgeCard.tsx`

**Step 1: Create the component**

```tsx
import { useState } from 'react'

interface BurntEdgeCardProps {
  title: string
  children: React.ReactNode
  /** Optional subtitle shown below title when collapsed */
  subtitle?: string
}

export function BurntEdgeCard({ title, subtitle, children }: BurntEdgeCardProps) {
  const [expanded, setExpanded] = useState(false)

  return (
    <div
      className="group relative overflow-hidden"
      style={{
        /* Charred edge gradient on left border */
        borderLeft: '3px solid',
        borderImage: 'linear-gradient(to bottom, #7F1D1D, #5C3A1E, #3D2B1A, #1A1008) 1',
      }}
    >
      {/* Scorch overlay on top/bottom edges */}
      <div
        className="pointer-events-none absolute inset-x-0 top-0 h-[2px]"
        style={{
          background: 'linear-gradient(to right, #3D2B1A, transparent 30%, transparent 70%, #3D2B1A)',
        }}
      />
      <div
        className="pointer-events-none absolute inset-x-0 bottom-0 h-[2px]"
        style={{
          background: 'linear-gradient(to right, #1A1008, transparent 40%, transparent 60%, #1A1008)',
        }}
      />

      <button
        type="button"
        onClick={() => setExpanded((prev) => !prev)}
        className="w-full cursor-pointer bg-ash/80 px-5 py-4 text-left transition-colors hover:bg-smoke/60"
        aria-expanded={expanded}
      >
        <div className="flex items-center justify-between">
          <h4 className="font-heading text-[clamp(0.95rem,2.5vw,1.15rem)] font-bold text-paper-aged">
            {title}
          </h4>
          <span
            className="ml-3 text-[0.8rem] text-stone transition-transform duration-300"
            style={{ transform: expanded ? 'rotate(180deg)' : 'rotate(0deg)' }}
          >
            ▼
          </span>
        </div>
        {subtitle && !expanded && (
          <p className="mt-1 font-narrative text-[0.85rem] text-stone">
            {subtitle}
          </p>
        )}
      </button>

      <div
        className="overflow-hidden transition-all duration-500"
        style={{
          maxHeight: expanded ? '2000px' : '0px',
          opacity: expanded ? 1 : 0,
        }}
      >
        <div className="bg-void/60 px-5 py-4">
          {children}
        </div>
      </div>
    </div>
  )
}
```

**Step 2: Verify build**

```bash
npm run build
```

Expected: Build succeeds.

**Step 3: Commit**

```bash
git add src/components/interactive/BurntEdgeCard.tsx
git commit -m "feat: create BurntEdgeCard expandable component with charred edge effect"
```

---

### Task 4: Create PageCounter component

Floating counter showing "您已閱覽第 N/5,000 頁". Used in Ch.04 to create the oppressive feeling of browsing surveillance files. Shows in the bottom-right corner while the surveillance chapter is visible.

**Files:**
- Create: `src/components/surveillance/PageCounter.tsx`

**Step 1: Create the component**

```tsx
interface PageCounterProps {
  /** Current page count */
  current: number
  /** Total pages (default 5000) */
  total?: number
  /** Whether the counter is visible */
  visible: boolean
}

export function PageCounter({ current, total = 5000, visible }: PageCounterProps) {
  return (
    <div
      className="fixed bottom-6 right-6 z-50 transition-all duration-500"
      style={{
        opacity: visible ? 1 : 0,
        transform: visible ? 'translateY(0)' : 'translateY(20px)',
        pointerEvents: visible ? 'auto' : 'none',
      }}
      aria-live="polite"
      aria-label={`已閱覽 ${current} / ${total} 頁`}
    >
      <div className="border border-surveillance-green/30 bg-void/90 px-4 py-2 font-document text-[0.75rem] tracking-[0.1em] text-surveillance-green/80 shadow-[0_0_15px_rgba(74,103,65,0.1)] backdrop-blur-sm">
        您已閱覽第{' '}
        <span className="text-[0.9rem] text-surveillance-green">{current.toLocaleString()}</span>
        {' / '}
        {total.toLocaleString()} 頁
      </div>
    </div>
  )
}
```

**Step 2: Verify build**

```bash
npm run build
```

Expected: Build succeeds.

**Step 3: Commit**

```bash
git add src/components/surveillance/PageCounter.tsx
git commit -m "feat: create PageCounter floating surveillance page counter"
```

---

### Task 5: Generate pixel art placeholder PNGs

Phase 1 used ImageMagick to create 320×180 olive-toned placeholder PNGs. Create two more for Ch.04 and Ch.05.

**Files:**
- Create: `src/assets/pixel-art/intelligence-office.png`
- Create: `src/assets/pixel-art/charred-office.png`

**Step 1: Generate intelligence office placeholder**

```bash
convert -size 320x180 xc:'#0D120D' \
  -fill '#1A211A' -draw "rectangle 20,120 90,170" \
  -fill '#242E24' -draw "rectangle 100,100 180,170" \
  -fill '#1A211A' -draw "rectangle 200,90 300,170" \
  -fill '#4A6741' -draw "rectangle 140,20 160,80" \
  -fill '#33FF3308' -draw "rectangle 130,15 170,25" \
  -fill '#7D7772' -draw "rectangle 50,130 80,160" \
  -fill '#8B9D6B' -draw "rectangle 210,110 280,140" \
  src/assets/pixel-art/intelligence-office.png
```

**Step 2: Generate charred office placeholder**

```bash
convert -size 320x180 xc:'#1A1008' \
  -fill '#3D2B1A' -draw "rectangle 10,80 100,170" \
  -fill '#5C3A1E' -draw "rectangle 120,60 200,170" \
  -fill '#3D2B1A' -draw "rectangle 220,100 300,170" \
  -fill '#CC440030' -draw "rectangle 0,0 320,30" \
  -fill '#FF6B0010' -draw "rectangle 140,10 180,50" \
  -fill '#E8DCC410' -draw "line 250,0 250,180" \
  src/assets/pixel-art/charred-office.png
```

**Step 3: Verify files exist**

```bash
ls -la src/assets/pixel-art/*.png
```

Expected: 5 PNG files total (3 existing + 2 new).

**Step 4: Commit**

```bash
git add src/assets/pixel-art/intelligence-office.png src/assets/pixel-art/charred-office.png
git commit -m "feat: add placeholder pixel art PNGs for Ch.04 and Ch.05"
```

---

## Batch 2: CRT Interactions (Tasks 6–7)

### Task 6: Create DecryptionInteraction component

CRT overlay interaction where users tap redacted bars on prosecution/surveillance documents to reveal hidden text. Uses the `archiveDocuments` data from `legal.ts`. Shows 「解密」stamp after each reveal. After all fields on a document are revealed, shows the `paradoxText` if present (the emotional climax for the 不起訴處分書).

**Files:**
- Create: `src/components/crt/DecryptionInteraction.tsx`

**Step 1: Create the component**

The interaction structure:
1. User sees a document with redacted fields (black bars)
2. Tap a bar → 「解密」text appears + field reveals
3. After all fields revealed → show paradoxText (if present) or move to next document
4. After all documents → show conclusion message

```tsx
import { useState } from 'react'
import { CRTOverlay } from './CRTOverlay'
import { archiveDocuments } from '../../data/legal'

interface DecryptionInteractionProps {
  open: boolean
  onClose: () => void
}

export function DecryptionInteraction({ open, onClose }: DecryptionInteractionProps) {
  const [currentDoc, setCurrentDoc] = useState(0)
  const [revealedFields, setRevealedFields] = useState<Set<string>>(new Set())
  const [completed, setCompleted] = useState(false)

  const doc = archiveDocuments[currentDoc]
  const allRevealed = doc.redactedFields.every((_, i) =>
    revealedFields.has(`${currentDoc}-${i}`),
  )
  const hasParadox = 'paradoxText' in doc && doc.paradoxText
  const [showParadox, setShowParadox] = useState(false)

  const handleReveal = (fieldIndex: number) => {
    const key = `${currentDoc}-${fieldIndex}`
    if (revealedFields.has(key)) return
    setRevealedFields((prev) => new Set(prev).add(key))
  }

  const handleNext = () => {
    if (hasParadox && !showParadox) {
      setShowParadox(true)
      return
    }
    if (currentDoc < archiveDocuments.length - 1) {
      setCurrentDoc((prev) => prev + 1)
      setShowParadox(false)
    } else {
      setCompleted(true)
    }
  }

  const handleReset = () => {
    setCurrentDoc(0)
    setRevealedFields(new Set())
    setCompleted(false)
    setShowParadox(false)
  }

  const handleClose = () => {
    handleReset()
    onClose()
  }

  return (
    <CRTOverlay open={open} onClose={handleClose} title="解密系統 DECLASSIFY">
      {completed ? (
        <div className="space-y-6 text-center">
          <div className="font-document text-[0.7rem] tracking-[0.2em] text-crt-green-dim">
            解密完成 — {archiveDocuments.length}/{archiveDocuments.length} 文件
          </div>
          <p className="text-[1rem] leading-[2] text-crt-green">
            兩份公文，一個案號。一份追訴他至死，另一份用他的死結案。
          </p>
          <button
            type="button"
            onClick={handleClose}
            className="mt-4 cursor-pointer border border-crt-green-dim/50 bg-transparent px-6 py-2 text-crt-green-dim transition-colors hover:border-crt-green hover:text-crt-green"
          >
            關閉終端機
          </button>
        </div>
      ) : showParadox && hasParadox ? (
        <div className="space-y-6">
          <div className="border border-crt-amber/30 bg-void/50 p-6">
            <p className="whitespace-pre-line text-center text-[1.1rem] leading-[2.2] text-crt-amber">
              {(doc as typeof archiveDocuments[1]).paradoxText}
            </p>
          </div>
          <button
            type="button"
            onClick={handleNext}
            className="w-full cursor-pointer border border-crt-green-dim/50 bg-transparent px-6 py-2 text-crt-green-dim transition-colors hover:border-crt-green hover:text-crt-green"
          >
            {currentDoc < archiveDocuments.length - 1 ? '下一份文件 →' : '結束解密'}
          </button>
        </div>
      ) : (
        <div className="space-y-6">
          {/* Document header */}
          <div className="space-y-1 text-[0.7rem] tracking-[0.15em] text-crt-green-dim">
            <div>文件 {currentDoc + 1}/{archiveDocuments.length}</div>
            <div>{doc.agency} — {doc.classification}</div>
            <div>案號：{doc.caseNo}</div>
          </div>

          <div className="border border-crt-green-dim/20 bg-void/50 p-4">
            <h4 className="mb-4 text-center text-[1rem] text-crt-green">
              {doc.title}
            </h4>

            {/* Redacted fields */}
            <div className="space-y-3">
              {doc.redactedFields.map((field, i) => {
                const key = `${currentDoc}-${i}`
                const isRevealed = revealedFields.has(key)

                return (
                  <div key={key} className="flex items-start gap-3">
                    <span className="mt-[2px] min-w-[5em] text-[0.75rem] text-crt-green-dim">
                      {field.fieldLabel}：
                    </span>
                    <button
                      type="button"
                      onClick={() => handleReveal(i)}
                      disabled={isRevealed}
                      className={`text-left transition-all duration-700 ${
                        isRevealed
                          ? 'cursor-default text-crt-amber'
                          : 'cursor-pointer bg-crt-green/10 px-2 py-[2px] text-transparent hover:bg-crt-green/20'
                      }`}
                      aria-label={isRevealed ? field.revealed : '點擊解密'}
                    >
                      {isRevealed ? (
                        <span>
                          <span className="mr-1 text-[0.7rem] text-seal-red">
                            [解密]
                          </span>
                          {field.revealed}
                        </span>
                      ) : (
                        field.redacted
                      )}
                    </button>
                  </div>
                )
              })}
            </div>
          </div>

          {/* Reveal count */}
          <div className="text-center text-[0.75rem] text-crt-green-dim">
            已解密{' '}
            {doc.redactedFields.filter((_, i) => revealedFields.has(`${currentDoc}-${i}`)).length}
            /{doc.redactedFields.length} 欄位
          </div>

          {/* Next button (appears when all fields revealed) */}
          {allRevealed && (
            <button
              type="button"
              onClick={handleNext}
              className="w-full cursor-pointer border border-crt-green-dim/50 bg-transparent px-6 py-2 text-crt-green-dim transition-colors hover:border-crt-green hover:text-crt-green"
            >
              {hasParadox
                ? '繼續 →'
                : currentDoc < archiveDocuments.length - 1
                  ? '下一份文件 →'
                  : '結束解密'}
            </button>
          )}
        </div>
      )}
    </CRTOverlay>
  )
}
```

**Step 2: Verify build**

```bash
npm run build
```

Expected: Build succeeds. Note: `archiveDocuments` is typed `as const` — the `paradoxText` property only exists on the second document. The cast `(doc as typeof archiveDocuments[1])` handles this safely since `showParadox` guards against accessing it on doc[0].

**Step 3: Commit**

```bash
git add src/components/crt/DecryptionInteraction.tsx
git commit -m "feat: create DecryptionInteraction CRT overlay for prosecution document reveals"
```

---

### Task 7: Create SurveillanceReportForm component

CRT overlay interaction where users fill out a 青谷專案 intelligence report: select source reliability (甲/乙/丙), content accuracy (一/二/三), and movement summary from options. Based on `surveillanceReportTemplates` data. Cycles through 3 templates; each completion shows 「已建檔 N/5,000 份」.

**Files:**
- Create: `src/components/crt/SurveillanceReportForm.tsx`

**Step 1: Create the component**

```tsx
import { useState } from 'react'
import { CRTOverlay } from './CRTOverlay'
import type { SourceReliability, ContentAccuracy } from '../../data/surveillance'
import { surveillanceReportTemplates } from '../../data/surveillance'

interface SurveillanceReportFormProps {
  open: boolean
  onClose: () => void
}

const reliabilityOptions: { value: SourceReliability; label: string }[] = [
  { value: '甲', label: '甲 — 可靠 (Reliable)' },
  { value: '乙', label: '乙 — 通常可靠 (Usually reliable)' },
  { value: '丙', label: '丙 — 不確定 (Uncertain)' },
]

const accuracyOptions: { value: ContentAccuracy; label: string }[] = [
  { value: '一', label: '一 — 已確認 (Confirmed)' },
  { value: '二', label: '二 — 可能屬實 (Probably true)' },
  { value: '三', label: '三 — 不確定 (Uncertain)' },
]

export function SurveillanceReportForm({ open, onClose }: SurveillanceReportFormProps) {
  const [currentTemplate, setCurrentTemplate] = useState(0)
  const [reliability, setReliability] = useState<SourceReliability | ''>('')
  const [accuracy, setAccuracy] = useState<ContentAccuracy | ''>('')
  const [selectedMovement, setSelectedMovement] = useState(-1)
  const [submitted, setSubmitted] = useState(false)
  const [showNote, setShowNote] = useState(false)
  const [completed, setCompleted] = useState(false)
  const [filesLogged, setFilesLogged] = useState(0)

  const template = surveillanceReportTemplates[currentTemplate]

  const handleSubmit = () => {
    if (!reliability || !accuracy || selectedMovement < 0) return
    setSubmitted(true)
    setFilesLogged((prev) => prev + 1)
  }

  const handleNext = () => {
    if (!showNote) {
      setShowNote(true)
      return
    }
    if (currentTemplate < surveillanceReportTemplates.length - 1) {
      setCurrentTemplate((prev) => prev + 1)
      resetForm()
    } else {
      setCompleted(true)
    }
  }

  const resetForm = () => {
    setReliability('')
    setAccuracy('')
    setSelectedMovement(-1)
    setSubmitted(false)
    setShowNote(false)
  }

  const handleReset = () => {
    setCurrentTemplate(0)
    resetForm()
    setCompleted(false)
    setFilesLogged(0)
  }

  const handleClose = () => {
    handleReset()
    onClose()
  }

  return (
    <CRTOverlay open={open} onClose={handleClose} title="情報報告填寫系統">
      {completed ? (
        <div className="space-y-6 text-center">
          <div className="font-document text-[0.7rem] tracking-[0.2em] text-crt-green-dim">
            █████████████████████ 作業完成
          </div>
          <p className="text-[1.1rem] text-crt-green">
            已建檔 {filesLogged}/5,000 份
          </p>
          <p className="whitespace-pre-line text-[0.9rem] leading-[2] text-crt-green-dim">
            {'這只是5000頁中的' + filesLogged + '頁。\n每一頁的另一端，都是一個人的日常。'}
          </p>
          <button
            type="button"
            onClick={handleClose}
            className="mt-4 cursor-pointer border border-crt-green-dim/50 bg-transparent px-6 py-2 text-crt-green-dim transition-colors hover:border-crt-green hover:text-crt-green"
          >
            關閉終端機
          </button>
        </div>
      ) : (
        <div className="space-y-5">
          {/* Agency header */}
          <div className="whitespace-pre-line border border-crt-green-dim/20 bg-void/80 p-3 text-[0.7rem] leading-[1.8] tracking-[0.1em] text-crt-green-dim">
            {template.agencyHeader}
          </div>

          <div className="text-[0.7rem] text-crt-green-dim">
            報告 {currentTemplate + 1}/{surveillanceReportTemplates.length} — {template.date}
          </div>

          <div className="text-[0.8rem] text-crt-green">
            監控對象：{template.subject}
          </div>

          {!submitted ? (
            <div className="space-y-5">
              {/* Source reliability */}
              <div className="space-y-2">
                <div className="text-[0.75rem] text-crt-green-dim">來源可靠性鑑定：</div>
                {reliabilityOptions.map((opt) => (
                  <label
                    key={opt.value}
                    className={`flex cursor-pointer items-center gap-3 border p-2 text-[0.8rem] transition-colors ${
                      reliability === opt.value
                        ? 'border-crt-green bg-crt-green/5 text-crt-green'
                        : 'border-crt-green-dim/20 text-crt-green-dim hover:border-crt-green-dim/50'
                    }`}
                  >
                    <input
                      type="radio"
                      name="reliability"
                      value={opt.value}
                      checked={reliability === opt.value}
                      onChange={() => setReliability(opt.value)}
                      className="accent-crt-green"
                    />
                    {opt.label}
                  </label>
                ))}
              </div>

              {/* Content accuracy */}
              <div className="space-y-2">
                <div className="text-[0.75rem] text-crt-green-dim">內容正確性鑑定：</div>
                {accuracyOptions.map((opt) => (
                  <label
                    key={opt.value}
                    className={`flex cursor-pointer items-center gap-3 border p-2 text-[0.8rem] transition-colors ${
                      accuracy === opt.value
                        ? 'border-crt-green bg-crt-green/5 text-crt-green'
                        : 'border-crt-green-dim/20 text-crt-green-dim hover:border-crt-green-dim/50'
                    }`}
                  >
                    <input
                      type="radio"
                      name="accuracy"
                      value={opt.value}
                      checked={accuracy === opt.value}
                      onChange={() => setAccuracy(opt.value)}
                      className="accent-crt-green"
                    />
                    {opt.label}
                  </label>
                ))}
              </div>

              {/* Movement summary */}
              <div className="space-y-2">
                <div className="text-[0.75rem] text-crt-green-dim">動態摘要（請選擇正確紀錄）：</div>
                {template.movementOptions.map((opt, i) => (
                  <label
                    key={i}
                    className={`flex cursor-pointer items-start gap-3 border p-2 text-[0.8rem] leading-[1.8] transition-colors ${
                      selectedMovement === i
                        ? 'border-crt-green bg-crt-green/5 text-crt-green'
                        : 'border-crt-green-dim/20 text-crt-green-dim hover:border-crt-green-dim/50'
                    }`}
                  >
                    <input
                      type="radio"
                      name="movement"
                      checked={selectedMovement === i}
                      onChange={() => setSelectedMovement(i)}
                      className="mt-1 accent-crt-green"
                    />
                    <span>{opt}</span>
                  </label>
                ))}
              </div>

              {/* Submit */}
              <button
                type="button"
                onClick={handleSubmit}
                disabled={!reliability || !accuracy || selectedMovement < 0}
                className="w-full cursor-pointer border border-crt-green bg-crt-green/10 px-6 py-3 font-heading text-[0.9rem] tracking-[0.1em] text-crt-green transition-all hover:bg-crt-green/20 disabled:cursor-not-allowed disabled:opacity-30"
              >
                送出報告
              </button>
            </div>
          ) : !showNote ? (
            <div className="space-y-4">
              {/* Result */}
              <div className="whitespace-pre-line border border-crt-green/30 bg-void/50 p-4 text-[0.85rem] leading-[1.8] text-crt-green">
                {template.completionMessage}
              </div>

              {/* Correctness feedback */}
              {(reliability !== template.correctSourceReliability ||
                accuracy !== template.correctContentAccuracy ||
                selectedMovement !== template.correctMovementIndex) && (
                <div className="border border-crt-amber/30 p-3 text-[0.8rem] text-crt-amber">
                  正確答案：來源 {template.correctSourceReliability}，
                  內容 {template.correctContentAccuracy}，
                  動態摘要第 {template.correctMovementIndex + 1} 項
                </div>
              )}

              <button
                type="button"
                onClick={handleNext}
                className="w-full cursor-pointer border border-crt-green-dim/50 bg-transparent px-6 py-2 text-crt-green-dim transition-colors hover:border-crt-green hover:text-crt-green"
              >
                查看歷史背景 →
              </button>
            </div>
          ) : (
            <div className="space-y-4">
              <div className="border border-crt-green-dim/20 bg-void/50 p-4 text-[0.85rem] leading-[2] text-crt-green-dim">
                {template.historicalNote}
              </div>
              <button
                type="button"
                onClick={handleNext}
                className="w-full cursor-pointer border border-crt-green-dim/50 bg-transparent px-6 py-2 text-crt-green-dim transition-colors hover:border-crt-green hover:text-crt-green"
              >
                {currentTemplate < surveillanceReportTemplates.length - 1
                  ? '下一份報告 →'
                  : '查看結語'}
              </button>
            </div>
          )}
        </div>
      )}
    </CRTOverlay>
  )
}
```

**Step 2: Verify build**

```bash
npm run build
```

Expected: Build succeeds.

**Step 3: Commit**

```bash
git add src/components/crt/SurveillanceReportForm.tsx
git commit -m "feat: create SurveillanceReportForm CRT overlay for intelligence report filling"
```

---

## Batch 3: Chapters (Tasks 8–10)

### Task 8: Create Investigation chapter (Ch.03)

**調查歷程：紙上的正義** — Government document aesthetic. Shows the prosecution timeline, the legal logic chain that turns words into a death sentence, the statute comparison (old vs. new article 100), and the 解密互動 CRT interaction.

**Files:**
- Create: `src/chapters/Investigation.tsx`

**Data imports needed:**
- `prosecutionTimeline` — 9 events from publication to legal reform
- `chengProsecutionChain` — 4-step legal logic chain
- `archiveDocuments` — used indirectly via DecryptionInteraction
- `article21Quotes` — pull quotes

**Step 1: Create the chapter**

```tsx
import { useState } from 'react'
import { Section } from '../components/layout/Section'
import { ScrollReveal } from '../components/narrative/ScrollReveal'
import { ChapterHeader } from '../components/layout/ChapterHeader'
import { DocumentPage } from '../components/narrative/DocumentPage'
import { StatuteComparison } from '../components/legal/StatuteComparison'
import { DecryptionInteraction } from '../components/crt/DecryptionInteraction'
import {
  prosecutionTimeline,
  chengProsecutionChain,
  article21Quotes,
} from '../data/legal'

export function Investigation() {
  const [decryptOpen, setDecryptOpen] = useState(false)

  return (
    <Section id="investigation" background="ink">
      <div className="mx-auto max-w-[640px] space-y-16">
        <ScrollReveal>
          <ChapterHeader
            label="CHAPTER 03"
            title="調查歷程：紙上的正義"
            labelColor="text-surveillance-green"
          />
        </ScrollReveal>

        {/* 3a: Prosecution timeline */}
        <ScrollReveal>
          <div className="space-y-4">
            <h3 className="font-heading text-[clamp(1.1rem,3vw,1.4rem)] font-bold text-paper-aged">
              從出版到死亡的司法歷程
            </h3>
            <div className="space-y-0">
              {prosecutionTimeline.map((event, i) => (
                <div key={event.date + event.label} className="relative flex gap-4 pb-6">
                  {/* Timeline line */}
                  {i < prosecutionTimeline.length - 1 && (
                    <div className="absolute left-[5px] top-3 h-full w-[1px] bg-surveillance-green/20" />
                  )}
                  {/* Dot */}
                  <div
                    className={`relative mt-[6px] h-[11px] w-[11px] shrink-0 rounded-full border ${
                      event.isKeyMoment
                        ? 'border-seal-red bg-seal-red/30'
                        : 'border-surveillance-green/50 bg-surveillance-green/10'
                    }`}
                  />
                  <div className="space-y-1">
                    <div className="font-document text-[0.75rem] text-surveillance-green/70">
                      {event.date}
                    </div>
                    <div className="font-heading text-[0.9rem] font-bold text-paper-aged">
                      {event.label}
                    </div>
                    <p className="font-narrative text-[0.85rem] leading-[1.9] text-dust">
                      {event.description}
                    </p>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </ScrollReveal>

        {/* 3b: Legal logic chain */}
        <ScrollReveal>
          <DocumentPage
            classification="偵查卷宗"
            title="法律如何殺人"
            stampText="唯一死刑"
          >
            <p className="mb-4 font-narrative text-[0.85rem] leading-[1.8] text-ink/70">
              {chengProsecutionChain.triggeringAct}
            </p>
            <div className="space-y-0">
              {chengProsecutionChain.steps.map((step) => (
                <div key={step.step} className="border-l-2 border-seal-red/30 py-3 pl-4">
                  <div className="mb-1 font-document text-[0.7rem] text-stone">
                    步驟 {step.step}：{step.label}
                  </div>
                  <p className="font-narrative text-[0.85rem] leading-[1.9] text-ink">
                    {step.detail}
                  </p>
                </div>
              ))}
            </div>
          </DocumentPage>
        </ScrollReveal>

        {/* Pull quote */}
        <ScrollReveal>
          <blockquote className="border-l-2 border-seal-red/40 pl-4">
            <p className="font-literary text-[clamp(1rem,2.5vw,1.15rem)] leading-[2.2] text-paper-aged">
              {article21Quotes[1].text}
            </p>
            <footer className="mt-2 font-document text-[0.7rem] text-stone/60">
              — {article21Quotes[1].attribution}
            </footer>
          </blockquote>
        </ScrollReveal>

        {/* CRT 解密互動 trigger */}
        <ScrollReveal>
          <div className="text-center">
            <p className="mb-6 font-narrative leading-[2] text-dust">
              起訴書與不起訴處分書——兩份公文，一個案號，一個荒謬的結局。
            </p>
            <button
              type="button"
              onClick={() => setDecryptOpen(true)}
              className="cursor-pointer border border-crt-green-dim/50 bg-void px-6 py-3 font-document text-[0.85rem] tracking-[0.15em] text-crt-green-dim transition-all duration-300 hover:border-crt-green hover:text-crt-green hover:shadow-[0_0_20px_rgba(51,255,51,0.1)]"
            >
              啟動解密系統
            </button>
          </div>
        </ScrollReveal>

        <DecryptionInteraction
          open={decryptOpen}
          onClose={() => setDecryptOpen(false)}
        />

        {/* 3c: Statute comparison */}
        <ScrollReveal>
          <div className="space-y-4">
            <h3 className="font-heading text-[clamp(1.1rem,3vw,1.4rem)] font-bold text-paper-aged">
              遲來的正義？
            </h3>
            <p className="font-narrative leading-[2] text-dust">
              鄭南榕死後兩年，《懲治叛亂條例》才被廢止。又過了一年，刑法第100條才修正——
              增加「以強暴脅迫」要件，純粹言論不再構成叛亂。
            </p>
          </div>
        </ScrollReveal>

        <ScrollReveal>
          <StatuteComparison />
        </ScrollReveal>

        {/* Source attribution */}
        <ScrollReveal>
          <div className="font-document text-[0.65rem] tracking-wider text-stone/50">
            [來源：國家檔案局、國家人權記憶庫、促轉會調查報告]
          </div>
        </ScrollReveal>
      </div>
    </Section>
  )
}
```

**Step 2: Verify build**

```bash
npm run build
```

Expected: Build succeeds.

**Step 3: Commit**

```bash
git add src/chapters/Investigation.tsx
git commit -m "feat: create Investigation chapter (Ch.03) with prosecution timeline and decryption CRT"
```

---

### Task 9: Create SurveillanceTruth chapter (Ch.04)

**監控真相：5000頁的凝視** — Peak horror chapter. Shows surveillance statistics, the surveillance file viewer with inline redactions, the pixel art intelligence office, the 監控報告填寫 CRT interaction, and the floating page counter.

**Files:**
- Create: `src/chapters/SurveillanceTruth.tsx`

**Data imports needed:**
- `surveillanceRecords` — 10 records for the file viewer
- `surveillanceStats` — aggregate statistics (5000 pages, agencies, etc.)
- `agencyHeaders` — formatted headers for document display
- `surveillanceQuotes` — key quotes for callouts

**Step 1: Create the chapter**

```tsx
import { useState, useEffect, useRef } from 'react'
import { Section } from '../components/layout/Section'
import { ScrollReveal } from '../components/narrative/ScrollReveal'
import { ChapterHeader } from '../components/layout/ChapterHeader'
import { DocumentPage } from '../components/narrative/DocumentPage'
import { PixelArtScene } from '../components/pixel-art/PixelArtScene'
import { Redacted } from '../components/narrative/Redacted'
import { PageCounter } from '../components/surveillance/PageCounter'
import { SurveillanceReportForm } from '../components/crt/SurveillanceReportForm'
import {
  surveillanceRecords,
  surveillanceStats,
  surveillanceQuotes,
} from '../data/surveillance'
import intelligenceOffice from '../assets/pixel-art/intelligence-office.png'

export function SurveillanceTruth() {
  const [reportOpen, setReportOpen] = useState(false)
  const [pagesViewed, setPagesViewed] = useState(0)
  const [counterVisible, setCounterVisible] = useState(false)
  const sectionRef = useRef<HTMLDivElement>(null)

  // Track section visibility for the floating page counter
  useEffect(() => {
    const el = sectionRef.current
    if (!el) return
    const observer = new IntersectionObserver(
      ([entry]) => setCounterVisible(entry.isIntersecting),
      { threshold: 0.05 },
    )
    observer.observe(el)
    return () => observer.disconnect()
  }, [])

  const handleRecordView = () => {
    setPagesViewed((prev) => prev + 1)
  }

  // Records with fullText for the file viewer
  const viewableRecords = surveillanceRecords.filter((r) => r.fullText)

  return (
    <>
      <div ref={sectionRef}>
        <Section id="surveillance-truth" background="void">
          <div className="mx-auto max-w-[640px] space-y-16">
            <ScrollReveal>
              <ChapterHeader
                label="CHAPTER 04"
                title="監控真相：5000頁的凝視"
                labelColor="text-surveillance-green"
              />
            </ScrollReveal>

            {/* 4a: Scale of surveillance */}
            <ScrollReveal>
              <div className="space-y-6 text-center">
                <div className="font-document text-[clamp(3rem,10vw,5rem)] font-bold leading-none text-surveillance-green/80">
                  {surveillanceStats.totalPages.toLocaleString()}
                </div>
                <p className="font-narrative text-[1rem] leading-[2] text-dust">
                  情治單位對鄭南榕的監控檔案超過五千頁。
                </p>
                <div className="mx-auto max-w-[400px] space-y-2 text-[0.85rem] text-stone">
                  <div className="flex justify-between border-b border-smoke/20 pb-1">
                    <span>監控機關</span>
                    <span className="text-surveillance-green">{surveillanceStats.agencies.length} 個</span>
                  </div>
                  <div className="flex justify-between border-b border-smoke/20 pb-1">
                    <span>監控期間</span>
                    <span className="text-surveillance-green">
                      {surveillanceStats.yearsActive.from}–{surveillanceStats.yearsActive.to}
                    </span>
                  </div>
                  <div className="flex justify-between border-b border-smoke/20 pb-1">
                    <span>死後仍持續監控</span>
                    <span className="text-seal-red">是</span>
                  </div>
                </div>
                <p className="font-narrative text-[0.85rem] text-stone">
                  如果每天讀十頁，要讀超過一年。
                </p>
              </div>
            </ScrollReveal>

            {/* Pixel art: intelligence office */}
            <ScrollReveal>
              <PixelArtScene
                src={intelligenceOffice}
                alt="情報辦公室鳥瞰——情治人員伏案撰寫報告，檔案櫃，轉盤電話，菸灰缸"
                caption="青谷專案下的情報辦公室：每一份報告的另一端，都是一個人的日常"
              />
            </ScrollReveal>

            {/* Quote */}
            <ScrollReveal>
              <blockquote className="border-l-2 border-surveillance-green/40 pl-4">
                <p className="font-literary text-[clamp(0.9rem,2.5vw,1.05rem)] leading-[2.2] text-paper-aged">
                  {surveillanceQuotes[0].text}
                </p>
                <footer className="mt-2 font-document text-[0.7rem] text-stone/60">
                  — {surveillanceQuotes[0].source}
                </footer>
              </blockquote>
            </ScrollReveal>

            {/* 4b: Surveillance file viewer */}
            <ScrollReveal>
              <div className="space-y-4">
                <h3 className="font-heading text-[clamp(1.1rem,3vw,1.4rem)] font-bold text-paper-aged">
                  監控檔案
                </h3>
                <p className="font-narrative text-[0.85rem] leading-[2] text-dust">
                  以下為解密後的情報報告摘錄。黑條處可點擊揭露原文。
                </p>
              </div>
            </ScrollReveal>

            {/* File viewer: each record as a DocumentPage */}
            {viewableRecords.map((record) => (
              <ScrollReveal key={record.id}>
                <DocumentPage
                  classification="機密"
                  title={`${record.agency} — ${record.date}`}
                  stampText={record.isRedacted ? '部分遮蔽' : undefined}
                  marginNote={record.archiveRef}
                >
                  <div className="whitespace-pre-line font-document text-[0.8rem] leading-[2] text-ink/80">
                    {record.fullText!.split(/(\[■■■\])/).map((segment, i) =>
                      segment === '[■■■]' ? (
                        <Redacted key={i} permanent onReveal={handleRecordView}>
                          ■■■
                        </Redacted>
                      ) : (
                        <span key={i}>{segment}</span>
                      ),
                    )}
                  </div>
                </DocumentPage>
              </ScrollReveal>
            ))}

            {/* Post-death surveillance callout */}
            <ScrollReveal>
              <div className="border border-seal-red/20 bg-void/50 p-6">
                <p className="font-narrative text-[0.95rem] leading-[2] text-paper-aged">
                  {surveillanceQuotes[3].text}
                </p>
                <footer className="mt-3 font-document text-[0.7rem] text-stone/60">
                  — {surveillanceQuotes[3].source}
                </footer>
              </div>
            </ScrollReveal>

            {/* CRT 監控報告填寫 trigger */}
            <ScrollReveal>
              <div className="text-center">
                <p className="mb-6 font-narrative leading-[2] text-dust">
                  如果你是情報員，你會如何填寫這份報告？
                </p>
                <button
                  type="button"
                  onClick={() => setReportOpen(true)}
                  className="cursor-pointer border border-crt-green-dim/50 bg-void px-6 py-3 font-document text-[0.85rem] tracking-[0.15em] text-crt-green-dim transition-all duration-300 hover:border-crt-green hover:text-crt-green hover:shadow-[0_0_20px_rgba(51,255,51,0.1)]"
                >
                  啟動情報報告填寫系統
                </button>
              </div>
            </ScrollReveal>

            <SurveillanceReportForm
              open={reportOpen}
              onClose={() => setReportOpen(false)}
            />

            {/* Structural note */}
            <ScrollReveal>
              <div className="border-l-2 border-surveillance-green/30 pl-4">
                <p className="font-narrative text-[0.85rem] leading-[2] text-stone">
                  {surveillanceStats.structuralNote}
                </p>
              </div>
            </ScrollReveal>

            {/* Source attribution */}
            <ScrollReveal>
              <div className="font-document text-[0.65rem] tracking-wider text-stone/50">
                [來源：促轉會監控檔案、國家檔案局、蘇慶軒《監視怎麼做？》、林易澄《威權體制與失控的執行者》]
              </div>
            </ScrollReveal>
          </div>
        </Section>
      </div>

      <PageCounter current={pagesViewed} visible={counterVisible} />
    </>
  )
}
```

**Step 2: Verify build**

```bash
npm run build
```

Expected: Build succeeds.

**Step 3: Commit**

```bash
git add src/chapters/SurveillanceTruth.tsx
git commit -m "feat: create SurveillanceTruth chapter (Ch.04) with file viewer, page counter, and CRT report form"
```

---

### Task 10: Create UnansweredQuestions chapter (Ch.05)

**未解之謎：燒焦的真相** — Pixel art charred office, then four expandable BurntEdgeCard mystery panels covering the unresolved questions about the case.

**Files:**
- Create: `src/chapters/UnansweredQuestions.tsx`

**Step 1: Create the chapter**

```tsx
import { Section } from '../components/layout/Section'
import { ScrollReveal } from '../components/narrative/ScrollReveal'
import { ChapterHeader } from '../components/layout/ChapterHeader'
import { PixelArtScene } from '../components/pixel-art/PixelArtScene'
import { BurntEdgeCard } from '../components/interactive/BurntEdgeCard'
import charredOffice from '../assets/pixel-art/charred-office.png'

const mysteries = [
  {
    title: '謎團一：警方攻堅的決定',
    subtitle: '誰下令？為什麼選4月7日？',
    content: [
      '1989年4月7日上午，警方對《自由時代》雜誌社發動攻堅。但關於這次行動的諸多細節，至今仍存在爭議。',
      '誰做出攻堅的最終決定？為什麼選擇4月7日——自囚的第71天？攻堅策略是否適當？是否考慮過替代方案？',
      '時任刑事警察局侯友宜主導現場指揮。他在事後的說詞在不同場合有所出入。攻堅是否符合比例原則，始終是一個未被充分釐清的問題。',
    ],
    source: '[來源：政府檔案、基金會紀錄]',
  },
  {
    title: '謎團二：現場證據保存',
    subtitle: '哪些證據已永久損毀？',
    content: [
      '鄭南榕基金會保留了燒毀現場的原貌，供後人憑弔與研究。但官方的證據保全程序是否完善，一直受到質疑。',
      '火災現場的鑑識報告是否完整？有哪些物證在火災中永久損毀？現場重建是否能還原最後時刻的全貌？',
      '這些問題的答案，隨著時間流逝和當事人凋零，可能永遠無法完整回答。',
    ],
    source: '[來源：基金會紀錄]',
  },
  {
    title: '謎團三：監控檔案的解密',
    subtitle: '五千頁中，還有多少未曾公開？',
    content: [
      '促轉會徵集了超過五千頁的鄭南榕監控檔案，但解密並非一次完成。部分檔案至今仍受限於機密等級或保存狀況，無法公開。',
      '更令人不安的是：已被銷毀的檔案。我們永遠不知道，在那些消失的紙頁中，記錄了什麼——哪些行動曾被規劃？哪些決定曾被做出？',
      '國家的記憶有時選擇性地遺忘。而被遺忘的部分，往往正是最關鍵的。',
    ],
    source: '[來源：促轉會調查報告]',
  },
  {
    title: '謎團四：制度性責任',
    subtitle: '有沒有人為此負責？',
    content: [
      '高檢署發出「涉嫌叛亂」傳票的決定——明知二條一意味著唯一死刑——是誰簽核的？情治系統持續監控、升高對峙的過程中，有沒有人提出過異議？',
      '鄭南榕自焚後，國家以「被告死亡，不予起訴」結案。追訴他至死的法律機器，沒有任何一個零件為此承擔責任。',
      '1991年《懲治叛亂條例》廢止、1992年刑法第100條修正，被視為「遲來的正義」。但制度性的反省——對那些簽核文件、執行監控、推動起訴的個人——從未真正發生。',
    ],
    source: '[來源：促轉會調查報告、國家人權記憶庫]',
  },
]

export function UnansweredQuestions() {
  return (
    <Section id="unanswered-questions" background="ash">
      <div className="mx-auto max-w-[640px] space-y-16">
        <ScrollReveal>
          <ChapterHeader
            label="CHAPTER 05"
            title="未解之謎：燒焦的真相"
            labelColor="text-scorch"
          />
        </ScrollReveal>

        {/* Pixel art: charred office */}
        <ScrollReveal>
          <PixelArtScene
            src={charredOffice}
            alt="燒毀的辦公室——焦黑內部，倒塌傢俱剪影，一道從破窗射入的光束；無人物"
            caption="《自由時代》雜誌社內部：基金會保存了現場原貌至今"
          />
        </ScrollReveal>

        <ScrollReveal>
          <p className="font-narrative leading-[2] text-dust">
            火焰帶走了一個人的生命，卻沒有燒盡所有的疑問。
            三十多年後，這些問題依然沒有完整的答案。
          </p>
        </ScrollReveal>

        {/* Mystery cards */}
        <div className="space-y-4">
          {mysteries.map((mystery, i) => (
            <ScrollReveal key={mystery.title} delay={i * 80}>
              <BurntEdgeCard title={mystery.title} subtitle={mystery.subtitle}>
                <div className="space-y-3">
                  {mystery.content.map((para, j) => (
                    <p
                      key={j}
                      className="font-narrative text-[0.9rem] leading-[2] text-dust"
                    >
                      {para}
                    </p>
                  ))}
                  <div className="mt-2 font-document text-[0.65rem] text-stone/50">
                    {mystery.source}
                  </div>
                </div>
              </BurntEdgeCard>
            </ScrollReveal>
          ))}
        </div>

        {/* Closing reflection */}
        <ScrollReveal>
          <blockquote className="border-l-2 border-scorch/40 pl-4">
            <p className="font-literary text-[clamp(0.95rem,2.5vw,1.1rem)] leading-[2.2] text-paper-aged">
              有些真相在火中燒成了灰。有些真相在檔案櫃中等待了三十年。
              還有一些真相，從未被寫成文字。
            </p>
          </blockquote>
        </ScrollReveal>

        {/* Source attribution */}
        <ScrollReveal>
          <div className="font-document text-[0.65rem] tracking-wider text-stone/50">
            [來源：促轉會調查報告、鄭南榕基金會紀錄、國家人權記憶庫]
          </div>
        </ScrollReveal>
      </div>
    </Section>
  )
}
```

**Step 2: Verify build**

```bash
npm run build
```

Expected: Build succeeds.

**Step 3: Commit**

```bash
git add src/chapters/UnansweredQuestions.tsx
git commit -m "feat: create UnansweredQuestions chapter (Ch.05) with burnt-edge mystery cards"
```

---

## Batch 4: App Integration (Task 11)

### Task 11: Integrate Ch.03, Ch.04, Ch.05 into App.tsx

Add lazy imports, nav items, Suspense wrappers, and ChapterTransition dividers for the three new chapters. They slot between `TheSeventyOneDays` (Ch.02) and `CallToAction` (Ch.06).

**Files:**
- Modify: `src/App.tsx`

**Step 1: Add lazy imports**

Add after the existing `TheSeventyOneDays` lazy import:

```tsx
const Investigation = lazy(() =>
  import('./chapters/Investigation').then((m) => ({ default: m.Investigation })),
)
const SurveillanceTruth = lazy(() =>
  import('./chapters/SurveillanceTruth').then((m) => ({ default: m.SurveillanceTruth })),
)
const UnansweredQuestions = lazy(() =>
  import('./chapters/UnansweredQuestions').then((m) => ({ default: m.UnansweredQuestions })),
)
```

**Step 2: Add nav items**

Update `navItems` to include the three new chapters between Ch.02 and Ch.06:

```tsx
const navItems = [
  { id: 'content-warning', label: '內容警告', labelEn: 'Content Warning', num: '—' },
  { id: 'prologue', label: '序章', labelEn: 'Prologue', num: '00' },
  { id: 'historical-context', label: '時代背景', labelEn: 'When Words Were Treason', num: '01' },
  { id: 'the-71-days', label: '案發經過', labelEn: 'The 71 Days', num: '02' },
  { id: 'investigation', label: '調查歷程', labelEn: 'Justice on Paper', num: '03' },
  { id: 'surveillance-truth', label: '監控真相', labelEn: '5,000 Pages', num: '04' },
  { id: 'unanswered-questions', label: '未解之謎', labelEn: 'Charred Truth', num: '05' },
  { id: 'call-to-action', label: '行動呼籲', labelEn: 'Call to Action', num: '06' },
]
```

**Step 3: Add Suspense blocks and transitions**

Replace the section between `TheSeventyOneDays` and `CallToAction`. The current code is:

```tsx
        <ChapterTransition variant="fire" />
        <Suspense fallback={<ChapterFallback />}>
          <CallToAction />
        </Suspense>
```

Replace with:

```tsx
        <ChapterTransition variant="ink" />
        <Suspense fallback={<ChapterFallback />}>
          <Investigation />
        </Suspense>
        <ChapterTransition variant="ink" />
        <Suspense fallback={<ChapterFallback />}>
          <SurveillanceTruth />
        </Suspense>
        <ChapterTransition variant="fire" />
        <Suspense fallback={<ChapterFallback />}>
          <UnansweredQuestions />
        </Suspense>
        <ChapterTransition variant="fire" />
        <Suspense fallback={<ChapterFallback />}>
          <CallToAction />
        </Suspense>
```

Transition logic: Ch.02→Ch.03 uses `ink` (cold institutional feel), Ch.03→Ch.04 uses `ink` (deeper into the bureaucratic horror), Ch.04→Ch.05 uses `fire` (transition to the aftermath), Ch.05→Ch.06 uses `fire` (from charred truth to warm dawn).

**Step 4: Verify build**

```bash
npm run build
```

Expected: Build succeeds with no errors. All lazy imports resolve.

**Step 5: Visual smoke test**

```bash
npm run dev
```

Open `http://localhost:5173/nylon/` in browser. Scroll through all chapters to verify:
- Nav shows all 8 items with correct numbers
- All chapters render without errors
- CRT interactions open and close
- Page counter appears/disappears with Ch.04 visibility
- BurntEdgeCards expand/collapse
- Redacted text reveals work (both toggle and permanent modes)

**Step 6: Commit**

```bash
git add src/App.tsx
git commit -m "feat: integrate Ch.03, Ch.04, Ch.05 into app shell with nav and transitions"
```

---

## Batch 5: Build Verification & CLAUDE.md Update (Task 12)

### Task 12: Final build verification and CLAUDE.md update

**Files:**
- Modify: `CLAUDE.md` (update project status section)

**Step 1: Production build**

```bash
npm run build
```

Expected: Build succeeds with no errors or warnings.

**Step 2: Update CLAUDE.md project status**

Update the "Completed" sections to reflect Phase 2 completion:

- Add a "Completed: Phase 2" section listing all new components and chapters
- Move Ch.03, Ch.04, Ch.05 from "Not Yet Created" to completed
- Update the components list with new entries (StatuteComparison, DecryptionInteraction, SurveillanceReportForm, PageCounter, BurntEdgeCard)
- Update "Not Yet Created" to only list Phase 3+ items

**Step 3: Commit**

```bash
git add CLAUDE.md
git commit -m "docs: update CLAUDE.md project status for Phase 2 completion"
```

---

## Summary

| Batch | Tasks | New Files | Modified Files |
|-------|-------|-----------|----------------|
| 1: Foundation | 1–5 | 4 components + 2 PNGs | `Redacted.tsx` |
| 2: CRT Interactions | 6–7 | 2 CRT components | — |
| 3: Chapters | 8–10 | 3 chapter files | — |
| 4: Integration | 11 | — | `App.tsx` |
| 5: Verification | 12 | — | `CLAUDE.md` |
| **Total** | **12 tasks** | **9 new files + 2 PNGs** | **3 modified files** |

### Component dependency tree

```
App.tsx
├── Investigation (Ch.03)
│   ├── StatuteComparison ← legal.ts (statuteComparisonData)
│   └── DecryptionInteraction ← legal.ts (archiveDocuments)
│       └── CRTOverlay (existing)
├── SurveillanceTruth (Ch.04)
│   ├── Redacted (modified: permanent prop)
│   ├── PageCounter
│   ├── SurveillanceReportForm ← surveillance.ts (templates)
│   │   └── CRTOverlay (existing)
│   └── DocumentPage (existing)
└── UnansweredQuestions (Ch.05)
    └── BurntEdgeCard
```
